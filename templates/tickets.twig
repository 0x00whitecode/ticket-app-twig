{% extends 'base.twig' %}

{% block content %}
<section>
    <h2>Tickets</h2>
    <div class="card form-card">
        <form method="POST" action="/tickets/create">
            <label>
                Title *
                <input required name="title" aria-required="true" aria-label="Ticket title" />
            </label>
            <div style="display:grid;grid-template-columns:1fr 160px;gap:.5rem">
                <label>
                    Status *
                    <select required name="status" aria-required="true">
                        <option value="open">open</option>
                        <option value="in_progress">in_progress</option>
                        <option value="closed">closed</option>
                    </select>
                </label>
                <label>
                    Priority
                    <select name="priority">
                        <option value="low">low</option>
                        <option value="medium">medium</option>
                        <option value="high">high</option>
                    </select>
                </label>
            </div>
            <label>
                Description
                <textarea name="description"></textarea>
            </label>
            <div class="form-actions">
                <button class="btn btn-primary" type="submit">Create</button>
            </div>
        </form>
    </div>

    <div class="mt-4">
        {% if tickets|length == 0 %}
        <p class="muted">No tickets yet. Create one above.</p>
        {% else %}
        <div class="grid tickets-grid">
            {% for ticket in tickets %}
            <div class="card ticket-card" data-status="{{ ticket.status }}">
                <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:.75rem">
                    <div style="flex:1">
                        <div class="ticket-head">
                            <h4>{{ ticket.title }}</h4>
                            <span class="badge status-{{ ticket.status }}">{{ ticket.status }}</span>
                        </div>
                        <p class="muted">{{ ticket.description }}</p>
                        <div class="ticket-meta">
                            <span>Priority: <strong style="text-transform:capitalize">{{ ticket.priority|default('low') }}</strong></span>
                            <span>â€¢</span>
                            <span>{{ ticket.created_at|date('Y-m-d H:i:s') }}</span>
                        </div>
                    </div>
                    <div style="flex:0 0 auto;display:flex;flex-direction:column;align-items:center;gap:.5rem">
                        <div style="width:84px;height:84px;border-radius:8px;border:1px solid #eef2ff;background:#fff;display:flex;align-items:center;justify-content:center">
                            <span style="font-size:.7rem">ticket:{{ ticket.id }}</span>
                        </div>
                        <div style="display:flex;gap:.5rem">
                            <form method="POST" action="/tickets/delete" style="display:inline">
                                <input type="hidden" name="id" value="{{ ticket.id }}" />
                                <button class="btn btn-danger" type="submit" onclick="return confirm('Delete this ticket?')">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}

